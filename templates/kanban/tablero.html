{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tablero Kanban</title>
    <link rel="stylesheet" href="{% static "dist/jkanban.min.css" %}" />
    <script src="{% static "dist/jkanban.min.js" %}"></script>
    <link
            href="https://fonts.googleapis.com/css?family=Lato"
            rel="stylesheet"
    />

    <style>
        body {
            font-family: "Lato";
            margin: 0;
            padding: 0;
        }

        #myKanban {
            overflow-x: auto;
            padding: 20px 0;
        }

        .success {
            background: #00b961;
        }

        .info {
            background: #2a92bf;
        }

        .warning {
            background: #f4ce46;
        }

        .error {
            background: #fb7d44;
        }

        .custom-button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 7px 15px;
            margin: 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }
    </style>
</head>
<body>

{{ tipos_dict|json_script:"tipos_dict" }}
<div id="myKanban"></div>
<button id="addDefault">Add "Default" board</button>
<br />
<button id="addToDo">Add element in "To Do" Board</button>
<br />
<button id="addToDoAtPosition">Add element in "To Do" Board at position 2</button>
<br />
<button id="removeBoard">Remove "Done" Board</button>
<br />
<button id="removeElement">Remove "My Task Test"</button>


<script>

    const tipos_dict = JSON.parse(document.getElementById('tipos_dict').textContent)

    console.log(tipos_dict)
    var KanbanTest = new jKanban({
        element: "#myKanban",
        gutter: "10px",
        widthBoard: "450px",
        itemHandleOptions:{
            enabled: true,
        },
        click: function(el) {
            console.log("Ver User Story");
        },
        boards: obtener_estados_kanban(tipos_dict)
        /*   boards: [
               {
                   id: "_todo",
                   title: "To Do (Can drop item only in working)",
                   class: "info,good",
                   dragTo: ["_working"],
                   item: getItems(us_dict)
               },
               {
                   id: "_working",
                   title: "Working (Try drag me too)",
                   class: "warning",
                   item: getItems(us_dict)
               },
               {
                   id: "_done",
                   title: "Done (Can drop item only in working)",
                   class: "success",
                   dragTo: ["_working"],
                   item: getItems(us_dict)
               }
           ]*/
    });



    function obtener_estados_kanban(tipos_dict){
        tipo = tipos_dict[1]
        boards = []
        estados = tipo.estados

        for (estado in estados){
            board = {}
            board.id = `_${estados[estado].id}`
            board.title = estados[estado].nombre
            board.item = getItems(tipo.user_stories, estados[estado].id)
            boards.push(board)
        }

        return boards
    }

    /*
    * {
                id: "_todo",
                title: "To Do (Can drop item only in working)",
                class: "info,good",
                dragTo: ["_working"],
                item: getItems(us_dict)
            },*/

    function getItems(us_dict, status){
        items = []
        console.log("estado")
        console.log(status)
        for (us in us_dict){
            console.log(us_dict[us].estado)

            if(us_dict[us].estado === status){
                item = {}
                item.id = us_dict[us].id
                item.title = us_dict[us].nombre
                items.push(item)
            }
        }
        return items
    }

</script>
</body>
</html>