{% load static %}


{% block head %}
    <link rel="stylesheet" href="{% static "dist/jkanban.min.css" %}" />
    <script src="{% static "dist/jkanban.min.js" %}"></script>
    <link
            href="https://fonts.googleapis.com/css?family=Lato"
            rel="stylesheet"
    />

    <style>
        body {
            font-family: "Lato";
            margin: 0;
            padding: 0;
        }

        #myKanban {
            overflow-x: auto;
            padding: 20px 0;
        }

        .success {
            background: #00b961;
        }

        .info {
            background: #2a92bf;
        }

        .warning {
            background: #f4ce46;
        }

        .error {
            background: #fb7d44;
        }

        .custom-button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 7px 15px;
            margin: 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }
    </style>
{% endblock %}

<body>
{% block content %}
    {{ tipos_dict|json_script:"tipos_dict" }}

    <div class="filtros" style="padding: 15px">Filtrar por:
        {% for tipo in tipos_dict %}
            <a href="{% url "kanban" id_proyecto=id_proyecto %}?id_tipo_us={{ tipo.id }}">{{ tipo.nombre }}</a>
        {% endfor %}
    </div>

    <div class="titulo-tipo-us" style="padding-left: 15px">Tipo de US: {{ tipo_mostrado_en_pantalla }}</div>

    <div id="myKanban"></div>


    <script>

        const tipos_dict = JSON.parse(document.getElementById('tipos_dict').textContent)
        id_tipo_us = 2
        console.log(tipos_dict)
        var KanbanTest = new jKanban({
            element: "#myKanban",
            gutter: "10px",
            widthBoard: "300px",
            itemHandleOptions:{
                enabled: true,
            },
            click: function(el) {
                id_us = el.getAttribute("data-eid")
                url = `/proyecto/{{ id_proyecto }}/backlog/US/${id_us}`

                window.location.href=url
            },
            boards: obtener_estados_kanban(tipos_dict),
            dragBoards: false,
            /*   boards: [
                   {
                       id: "_todo",
                       title: "To Do (Can drop item only in working)",
                       class: "info,good",
                       dragTo: ["_working"],
                       item: getItems(us_dict)
                   },
                   {
                       id: "_working",
                       title: "Working (Try drag me too)",
                       class: "warning",
                       item: getItems(us_dict)
                   },
                   {
                       id: "_done",
                       title: "Done (Can drop item only in working)",
                       class: "success",
                       dragTo: ["_working"],
                       item: getItems(us_dict)
                   }
               ]*/
        });



        function obtener_estados_kanban(tipos_dict){
            console.log(id_tipo_us)
            tipo = tipos_dict.filter((x)=> x.id === {{ id_tipo_us }})[0]

            boards = []
            estados = tipo.estados

            for (estado in estados){
                board = {}
                board.id = `_${estados[estado].id}`
                board.title = estados[estado].nombre
                board.item = getItems(tipo.user_stories, estados[estado].id)
                boards.push(board)
            }

            return boards
        }

        /*
        * {
                    id: "_todo",
                    title: "To Do (Can drop item only in working)",
                    class: "info,good",
                    dragTo: ["_working"],
                    item: getItems(us_dict)
                },*/

        function getItems(us_dict, status){
            items = []
            console.log("estado")
            console.log(status)
            for (us in us_dict){
                console.log(us_dict[us].estado)

                if(us_dict[us].estado === status){
                    item = {}
                    item.id = us_dict[us].id
                    item.title = html_del_user_story(us_dict[us])
                    item.username = us_dict[us].desarrollador

                    items.push(item)
                }
            }
            return items
        }

        function html_del_user_story(us_item){
            return `<div>${us_item.nombre}</div><br><div>Dev: ${us_item.desarrollador}</div>`
        }


    </script>

{% endblock %}
</body>
</html>